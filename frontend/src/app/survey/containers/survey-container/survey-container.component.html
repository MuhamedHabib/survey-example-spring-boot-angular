<!--
  ~ Copyright (C) 2018 Joumen Harzli
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
  ~ in compliance with the License. You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software distributed under the License
  ~ is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
  ~ or implied. See the License for the specific language governing permissions and limitations under
  ~ the License.
  ~
  -->

<div *ngIf="loading">
  <mat-spinner></mat-spinner>
</div>
<div *ngIf="error">{{ error.message }} </div>
<form [formGroup]="form" (submit)="submitForm(form)" *ngIf="!loading && !error">

  <mat-accordion>

    <mat-expansion-panel *ngFor="let subject of subjects; trackBy: trackByFn">

      <mat-expansion-panel-header>
        <mat-panel-title>
          {{ subject.label }}
        </mat-panel-title>

      </mat-expansion-panel-header>

      <mat-form-field *ngFor="let question of subject.questions; let questionIndex=index">
        <label [for]="'question'+questionIndex">{{question.label}}</label>

        <!-- Map responses values to the response content via hidden inputs -->
        <div [formGroupName]="getFormGroupIndexByQuestionId(question.id)">
          <input type="hidden" formControlName="questionId" />
          <input type="text" matInput id="'question'+questionIndex" formControlName="content" />
        </div>
      </mat-form-field>

    </mat-expansion-panel>

  </mat-accordion>

  <div class="submit-button">
    <button [disabled]="form.invalid" type="submit" mat-raised-button color="primary">Send</button>
  </div>

</form>
